<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.106.0"><meta name=description content="CBS Data Science for Business Applications 2022"><meta name=author content="Roman Jurowetzki & Daniel Hain"><link rel=icon href=/DSBA-2022/images/favicon.png type=image/png><title>Rapid Prototyping with Streamlit :: Social Data Science 2022</title><link href=/DSBA-2022/css/nucleus.css?1668851358 rel=stylesheet><link href=/DSBA-2022/css/fontawesome-all.min.css?1668851358 rel=stylesheet><link href=/DSBA-2022/css/hybrid.css?1668851358 rel=stylesheet><link href=/DSBA-2022/css/featherlight.min.css?1668851358 rel=stylesheet><link href=/DSBA-2022/css/perfect-scrollbar.min.css?1668851358 rel=stylesheet><link href=/DSBA-2022/css/auto-complete.css?1668851358 rel=stylesheet><link href=/DSBA-2022/css/atom-one-dark-reasonable.css?1668851358 rel=stylesheet><link href=/DSBA-2022/css/theme.css?1668851358 rel=stylesheet><link href=/DSBA-2022/css/tabs.css?1668851358 rel=stylesheet><link href=/DSBA-2022/css/hugo-theme.css?1668851358 rel=stylesheet><script src=/DSBA-2022/js/jquery-3.3.1.min.js?1668851358></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/DSBA-2022/m1/02_basics/04-interactive-dataviz/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a href=https://sds-aau.github.io/DSBA-2022/><img alt=logo src=/DSBA-2022/images/logo.png></a>
Data Science for Business Applications 2022</div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/DSBA-2022/js/lunr.min.js?1668851358></script>
<script type=text/javascript src=/DSBA-2022/js/auto-complete.js?1668851358></script>
<script type=text/javascript>var baseurl="https://sds-aau.github.io/DSBA-2022/"</script><script type=text/javascript src=/DSBA-2022/js/search.js?1668851358></script></div><div class=highlightable><ul class=topics><li data-nav-id=/DSBA-2022/info/ title="Info, Schedule & Co" class=dd-item><a href=/DSBA-2022/info/>Info, Schedule & Co
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/info/01_infrastructure/ title=Infrastructure class=dd-item><a href=/DSBA-2022/info/01_infrastructure/>Infrastructure
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/info/02_modules/ title=Modules class=dd-item><a href=/DSBA-2022/info/02_modules/>Modules
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/info/03_schedule/ title="Semester Schedule" class=dd-item><a href=/DSBA-2022/info/03_schedule/>Semester Schedule
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/info/04_litetrature/ title="Literature & Resources" class=dd-item><a href=/DSBA-2022/info/04_litetrature/>Literature & Resources
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/info/05_requirements_project/ title="Semester Project Requirements" class=dd-item><a href=/DSBA-2022/info/05_requirements_project/>Semester Project Requirements
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m1/ title="Applied Data Science and Machine Learning" class="dd-item
parent"><a href=/DSBA-2022/m1/><b>1. </b>Applied Data Science and Machine Learning
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m1/01_warmup/ title="Warmup (W36)" class=dd-item><a href=/DSBA-2022/m1/01_warmup/>Warmup (W36)
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m1/01_warmup/01_business/ title="Intro Talk - Data Science in business" class=dd-item><a href=/DSBA-2022/m1/01_warmup/01_business/>Intro Talk - Data Science in business
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m1/01_warmup/02_ecosystem/ title="The Data Science Ecosystem" class=dd-item><a href=/DSBA-2022/m1/01_warmup/02_ecosystem/>The Data Science Ecosystem
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m1/02_basics/ title="Basics of Statistical Programming and Data Manipulation (W36)" class="dd-item
parent"><a href=/DSBA-2022/m1/02_basics/>Basics of Statistical Programming and Data Manipulation (W36)
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m1/02_basics/01_stat_prog/ title="Basics Statistical Programming" class=dd-item><a href=/DSBA-2022/m1/02_basics/01_stat_prog/>Basics Statistical Programming
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m1/02_basics/02_data_manipulation/ title="Basics Data Manipulation" class=dd-item><a href=/DSBA-2022/m1/02_basics/02_data_manipulation/>Basics Data Manipulation
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m1/02_basics/03_data_visualization/ title="Basics Data Visualization" class=dd-item><a href=/DSBA-2022/m1/02_basics/03_data_visualization/>Basics Data Visualization
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m1/02_basics/04-interactive-dataviz/ title="Rapid Prototyping with Streamlit" class="dd-item active"><a href=/DSBA-2022/m1/02_basics/04-interactive-dataviz/>Rapid Prototyping with Streamlit
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m1/03_ml/ title="Basics Machine Learning (W37-38)" class=dd-item><a href=/DSBA-2022/m1/03_ml/>Basics Machine Learning (W37-38)
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m1/03_ml/01_uml/ title="Unsupervised Machine Learning (UML)" class=dd-item><a href=/DSBA-2022/m1/03_ml/01_uml/>Unsupervised Machine Learning (UML)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m1/03_ml/02_sml/ title="Supervised Machine Learning (SML)" class=dd-item><a href=/DSBA-2022/m1/03_ml/02_sml/>Supervised Machine Learning (SML)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m1/03_ml/03-uml-workshop/ title="Unsupervised Machine Learning - Applied" class=dd-item><a href=/DSBA-2022/m1/03_ml/03-uml-workshop/>Unsupervised Machine Learning - Applied
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m1/09_workshops/ title=Workshops class=dd-item><a href=/DSBA-2022/m1/09_workshops/>Workshops
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m1/09_workshops/w1/ title="Day 1 UML" class=dd-item><a href=/DSBA-2022/m1/09_workshops/w1/>Day 1 UML
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m1/09_workshops/w2/ title="Day 2 SML" class=dd-item><a href=/DSBA-2022/m1/09_workshops/w2/>Day 2 SML
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m1/10_assignments/ title="Assignments & Exercises" class=dd-item><a href=/DSBA-2022/m1/10_assignments/>Assignments & Exercises
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m1/10_assignments/exercise1/ title="Exercise 1 - EDA with Digital Nomads" class=dd-item><a href=/DSBA-2022/m1/10_assignments/exercise1/>Exercise 1 - EDA with Digital Nomads
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m1/10_assignments/exercise2/ title="Exercise 2 - UML with Pokemon" class=dd-item><a href=/DSBA-2022/m1/10_assignments/exercise2/>Exercise 2 - UML with Pokemon
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m1/10_assignments/group_assignment/ title="M1 (Mandatory) Assignment" class=dd-item><a href=/DSBA-2022/m1/10_assignments/group_assignment/>M1 (Mandatory) Assignment
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/DSBA-2022/m2/ title="Network Analysis & NLP" class=dd-item><a href=/DSBA-2022/m2/><b>2. </b>Network Analysis & NLP
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m2/01_networks/ title="Network Analysis" class=dd-item><a href=/DSBA-2022/m2/01_networks/>Network Analysis
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m2/01_networks/1_networks/ title="Basics Network Analysis" class=dd-item><a href=/DSBA-2022/m2/01_networks/1_networks/>Basics Network Analysis
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m2/01_networks/2_networks_intermediate/ title="Intermediate Network Analysis" class=dd-item><a href=/DSBA-2022/m2/01_networks/2_networks_intermediate/>Intermediate Network Analysis
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m2/01_networks/3_networks_2mode/ title="Network 2-Mode" class=dd-item><a href=/DSBA-2022/m2/01_networks/3_networks_2mode/>Network 2-Mode
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m2/02_nlp/ title="Natural Language Processing" class=dd-item><a href=/DSBA-2022/m2/02_nlp/>Natural Language Processing
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m2/02_nlp/0_nlp_theory/ title="Natural Language Processing - Theory" class=dd-item><a href=/DSBA-2022/m2/02_nlp/0_nlp_theory/>Natural Language Processing - Theory
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m2/02_nlp/1_nlp_string/ title="Application: String Manipulation" class=dd-item><a href=/DSBA-2022/m2/02_nlp/1_nlp_string/>Application: String Manipulation
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m2/02_nlp/2_nlp_longtext/ title="Application: Working with long text" class=dd-item><a href=/DSBA-2022/m2/02_nlp/2_nlp_longtext/>Application: Working with long text
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m2/02_nlp/3_nlp_topic/ title="Application: Vectorization and Topic Modelling" class=dd-item><a href=/DSBA-2022/m2/02_nlp/3_nlp_topic/>Application: Vectorization and Topic Modelling
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m2/00_assignments/ title=Assignments class=dd-item><a href=/DSBA-2022/m2/00_assignments/>Assignments
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m2/00_assignments/exercise1/ title="Exercise 1 - Network Analysis" class=dd-item><a href=/DSBA-2022/m2/00_assignments/exercise1/>Exercise 1 - Network Analysis
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m2/00_assignments/exercise2/ title="Exercise t 2 - NLP" class=dd-item><a href=/DSBA-2022/m2/00_assignments/exercise2/>Exercise t 2 - NLP
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m2/00_assignments/group_assignment/ title="M2 (Mandatory) Assignment" class=dd-item><a href=/DSBA-2022/m2/00_assignments/group_assignment/>M2 (Mandatory) Assignment
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m2/00_workshops/ title=Workshops class=dd-item><a href=/DSBA-2022/m2/00_workshops/>Workshops
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m2/00_workshops/01_workshop1/ title="Day 1 - NLP" class=dd-item><a href=/DSBA-2022/m2/00_workshops/01_workshop1/>Day 1 - NLP
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m2/00_workshops/02_workshop2/ title="Day 2 - Networks" class=dd-item><a href=/DSBA-2022/m2/00_workshops/02_workshop2/>Day 2 - Networks
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/DSBA-2022/m3/ title="Deep Learning" class=dd-item><a href=/DSBA-2022/m3/><b>3. </b>Deep Learning
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m3/01_ann/ title="Introduction to Neural Networks" class=dd-item><a href=/DSBA-2022/m3/01_ann/>Introduction to Neural Networks
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m3/01_ann/1_ann/ title="Introduction Neural Networks" class=dd-item><a href=/DSBA-2022/m3/01_ann/1_ann/>Introduction Neural Networks
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m3/02_cnn_rnn/ title="Advanced architectures" class=dd-item><a href=/DSBA-2022/m3/02_cnn_rnn/>Advanced architectures
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m3/02_cnn_rnn/1_cnn/ title="Convolutional Neural Networks" class=dd-item><a href=/DSBA-2022/m3/02_cnn_rnn/1_cnn/>Convolutional Neural Networks
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m3/02_cnn_rnn/2_rnn/ title="Recurrent Neural Networks" class=dd-item><a href=/DSBA-2022/m3/02_cnn_rnn/2_rnn/>Recurrent Neural Networks
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m3/00_assignments/ title=Assignments class=dd-item><a href=/DSBA-2022/m3/00_assignments/>Assignments
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m3/00_assignments/02_assignment/ title="Exercise 1 - AirBnB revisited" class=dd-item><a href=/DSBA-2022/m3/00_assignments/02_assignment/>Exercise 1 - AirBnB revisited
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m3/00_assignments/01_exercise1/ title="M3: Mandatory Assignment" class=dd-item><a href=/DSBA-2022/m3/00_assignments/01_exercise1/>M3: Mandatory Assignment
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/DSBA-2022/m3/00_workshops/ title=Workshops class=dd-item><a href=/DSBA-2022/m3/00_workshops/>Workshops
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/DSBA-2022/m3/00_workshops/01_workshop1/ title="Day 1 - Time Series Prediction" class=dd-item><a href=/DSBA-2022/m3/00_workshops/01_workshop1/>Day 1 - Time Series Prediction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/DSBA-2022/m3/00_workshops/02_workshop2/ title="Day 2 - NLP, Ecosystem, SOTA, Outlook" class=dd-item><a href=/DSBA-2022/m3/00_workshops/02_workshop2/>Day 2 - NLP, Ecosystem, SOTA, Outlook
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li></ul><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><center><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></center><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span class=links><a href=/DSBA-2022/>Data Science for Business Applications 2022</a> > <a href=/DSBA-2022/m1/>Applied Data Science and Machine Learning</a> > <a href=/DSBA-2022/m1/02_basics/>Basics of Statistical Programming and Data Manipulation (W36)</a> > Rapid Prototyping with Streamlit</span></div></div></div><div id=head-tags></div><div id=body-inner><h1>Rapid Prototyping with Streamlit</h1><p><img src="https://aws1.discourse-cdn.com/business7/uploads/streamlit/original/2X/2/247a8220ebe0d7e99dbbd31a2c227dde7767fbe1.gif?height=200px" alt></p><p>Streamlit was first released in October 2019 and has gained enormous popularity in the past year. The reason behind the framework&rsquo;s success is the ease with which it allows data scientists to build data-driven web apps without the need to deal with frontend development or other dev-ops stuff while allowing them to incorporate all kinds of functions going far beyond just dashboards. Going from a Jupyter Notebook to a Streamlit app just requires adding a few lines of code and rewriting a few minor things.</p><h2 id=from-ipynb-to-web-app>From ipynb to web-app</h2><p>In this tutorial, we will be going back to <a href=https://colab.research.google.com/github/aaubs/ds-master/blob/main/notebooks/M1-airbnb-eda-geoplot-class.ipynb.ipynb target=_blank><i class="fas fa-laptop-code"></i>
this Airbnb EDA Notebook</a> from last week and building a little web-app from it.</p><p><strong>Plan of attack</strong></p><ul><li>We will isolate the data-prep and visualization parts we are interested in</li><li>Build & test the app in uCloud</li><li>Deploy the app via GitHub to the Streamlit Cloud (this step is optional, as you can also deploy via uCloud - ~2kr/day server costs)</li></ul><div class="notices info"><p><a href=https://cloud.sdu.dk target=_blank>uCloud</a> is a uninversity cloud service. You get 1000 DKK and 50GB storage to start with but you can apply for more. This is usually granted, as the service is not used a lot. It&rsquo;s a great place to learn about modern platforms, infrastructure and more. You can play with different types of installations in a safe environment. You can also request very powerful machines.</p></div><h3 id=ucloud-set-up>UCloud Set-up</h3><p>For this project you will need 2 app-containers running: Coder-python and Streamlit. Both can run with minimal CPU/RAM requirements.
Streamlit can only run once you created a project in Code-python and saved an <code>app.py</code> file. It is a good idea, to create a public link and connect it to the streamlit-app. Thus, you can try out your app on your phone or share it.
Saving changes in <code>app.py</code> will trigger imediate recomplies and your app will update everywhere.</p><h3 id=streamlit-syntax-and-layout>Streamlit syntax and layout</h3><p>Now, what do we need to turn our notebook into a web app?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. page-config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>st<span style=color:#f92672>.</span>set_page_config(page_title<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Streamlit - Dashboard 🤯&#39;</span>,
</span></span><span style=display:flex><span>                    page_icon<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;🚀&#34;</span>,
</span></span><span style=display:flex><span>                    layout<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;wide&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. Page layout - e.g. a title</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>st<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#34;AirBnb rentals in Copenhagen 🇩🇰&#34;</span>)
</span></span></code></pre></div><p>Streamlit layout follows your script - things that come first, will be displayed first&mldr;etc.</p><h3 id=loading-and-preprocessing-the-data>Loading and preprocessing the data</h3><p>We can just proceed as in a notebook, but it is useful to rewrite the data loading and preprocessing into a function and add the <code>@st.experimental_singleton</code> decorator. Streamlit performs a re-run every time something is chaged (UI) by the user e.g. a new filter is set. To reduce processing time it&rsquo;s a good idea not to re-run data-loading every single time.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># LOAD DATA ONLY ONCE</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@st</span><span style=color:#f92672>.</span>experimental_singleton
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load_data</span>():
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#39;http://data.insideairbnb.com/denmark/hovedstaden/copenhagen/2022-06-24/visualisations/listings.csv&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># also preprocess as we did in the notebook</span>
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> data[data<span style=color:#f92672>.</span>number_of_reviews <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> data[data<span style=color:#f92672>.</span>room_type<span style=color:#f92672>.</span>isin([<span style=color:#e6db74>&#39;Private room&#39;</span>, <span style=color:#e6db74>&#39;Entire home/apt&#39;</span>])]
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#39;price_z&#39;</span>] <span style=color:#f92672>=</span> (data[<span style=color:#e6db74>&#39;price&#39;</span>] <span style=color:#f92672>-</span> data[<span style=color:#e6db74>&#39;price&#39;</span>]<span style=color:#f92672>.</span>mean())<span style=color:#f92672>/</span>data[<span style=color:#e6db74>&#39;price&#39;</span>]<span style=color:#f92672>.</span>std(ddof<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#39;price_z&#39;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;price_z&#39;</span>]<span style=color:#f92672>.</span>abs()
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> data[data<span style=color:#f92672>.</span>price_z <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>]
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#39;log_price&#39;</span>] <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>log(data[<span style=color:#e6db74>&#39;price&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># LOAD THE DATA NOW!</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> load_data()
</span></span></code></pre></div><h3 id=the-plots-to-be-rendered>The plots to be rendered</h3><p>We will go for 2 plots. A geo-visualization using <code>pydeck</code> and a simple <code>altair</code> bar plot to show prices in different areas of town.</p><p><strong>Geoplot</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>layer <span style=color:#f92672>=</span> pdk<span style=color:#f92672>.</span>Layer(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ScatterplotLayer&#34;</span>,
</span></span><span style=display:flex><span>        data<span style=color:#f92672>=</span>data[[<span style=color:#e6db74>&#39;name&#39;</span>,<span style=color:#e6db74>&#39;room_type&#39;</span>,<span style=color:#e6db74>&#39;price&#39;</span>, <span style=color:#e6db74>&#34;longitude&#34;</span>, <span style=color:#e6db74>&#34;latitude&#34;</span>]]<span style=color:#f92672>.</span>dropna(),
</span></span><span style=display:flex><span>        pickable<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>        opacity<span style=color:#f92672>=</span><span style=color:#ae81ff>0.7</span>,
</span></span><span style=display:flex><span>        stroked<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>        filled<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>        radius_scale<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>        radius_min_pixels<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        radius_max_pixels<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>,
</span></span><span style=display:flex><span>        line_width_min_pixels<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        get_position<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;longitude&#34;</span>, <span style=color:#e6db74>&#34;latitude&#34;</span>],
</span></span><span style=display:flex><span>        get_radius<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span><span style=color:#f92672>*</span><span style=color:#e6db74>&#34;log_price&#34;</span>,
</span></span><span style=display:flex><span>        get_color<span style=color:#f92672>=</span>[<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>140</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>        get_line_color<span style=color:#f92672>=</span>[<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set the viewport location</span>
</span></span><span style=display:flex><span>view_state <span style=color:#f92672>=</span> pdk<span style=color:#f92672>.</span>ViewState(latitude<span style=color:#f92672>=</span>data[<span style=color:#e6db74>&#39;latitude&#39;</span>]<span style=color:#f92672>.</span>mean(), longitude<span style=color:#f92672>=</span>data[<span style=color:#e6db74>&#39;longitude&#39;</span>]<span style=color:#f92672>.</span>mean(), zoom<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>, pitch<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Renders</span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> pdk<span style=color:#f92672>.</span>Deck(layers<span style=color:#f92672>=</span>[layer], 
</span></span><span style=display:flex><span>initial_view_state<span style=color:#f92672>=</span>view_state,
</span></span><span style=display:flex><span><span style=color:#75715e>#map_style=&#39;mapbox://styles/mapbox/light-v9&#39;,</span>
</span></span><span style=display:flex><span>tooltip<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;text&#34;</span>: <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{name}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{room_type}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{price}</span><span style=color:#e6db74>&#34;</span>}
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p><strong>Altair barplot</strong></p><p>When using altair, we need to add one more thing, which is the number of processed observations. Altair doesn&rsquo;t want to process beyond 5000 observations. That means that you have two options. Either you limit your data, as we will do here, or you pre-computed things in e.g. <code>pandas</code>.
Here we will use 2 simple if-statements to make sure that data is always max 5000 observations.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> len(data) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>5000</span>:
</span></span><span style=display:flex><span>    data_alt <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>sample(<span style=color:#ae81ff>5000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len(data) <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>5000</span>:
</span></span><span style=display:flex><span>    data_alt <span style=color:#f92672>=</span> data
</span></span></code></pre></div><p>We use altair to create a bar chart and let it calculate the mean of the price variable (x-axis) with y and colours being split by the room type. We spread the chart across rows that represent neighbourhoods. Also, we add a tooltip that displays the values for the individual bars. We set strokeWidth to 0 to make things a bit tidier.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>price_chart <span style=color:#f92672>=</span> alt<span style=color:#f92672>.</span>Chart(data)<span style=color:#f92672>.</span>mark_bar()<span style=color:#f92672>.</span>encode(
</span></span><span style=display:flex><span>    x<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;mean(price):Q&#39;</span>,
</span></span><span style=display:flex><span>    y<span style=color:#f92672>=</span>alt<span style=color:#f92672>.</span>Y(<span style=color:#e6db74>&#39;room_type:O&#39;</span>,axis<span style=color:#f92672>=</span>alt<span style=color:#f92672>.</span>Axis(labels<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>), title<span style=color:#f92672>=</span><span style=color:#e6db74>&#34; &#34;</span>),
</span></span><span style=display:flex><span>    color<span style=color:#f92672>=</span>alt<span style=color:#f92672>.</span>Color(<span style=color:#e6db74>&#39;room_type:N&#39;</span>, scale<span style=color:#f92672>=</span>alt<span style=color:#f92672>.</span>Scale(scheme<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;lightorange&#39;</span>)),
</span></span><span style=display:flex><span>    row<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;neighbourhood:N&#39;</span>,
</span></span><span style=display:flex><span>    tooltip<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;neighbourhood:N&#34;</span>, <span style=color:#e6db74>&#34;mean(price):Q&#34;</span>]
</span></span><span style=display:flex><span>)<span style=color:#f92672>.</span>configure_view(strokeWidth<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h3 id=introductin-ui--filters>Introductin UI / Filters</h3><p>We&rsquo;ll introduce 2 filters in the main page (you could also move them to the sidebar): price range and neighbourhood.
As you can see below, the <code>st.slider</code>and <code>st.multiselect</code> produce python objects (tuple and list) that we can use to filter our <code>data</code> DataFrame with plain Pandas.
e.g. When only 3 neighbourhoods are selected <code>neighbourhood_select</code> will turn a list of 3 elements and <code>data[data.neighbourhood.isin(neighbourhood_select)]</code> will result in a dataframe where only listings from these areas are present.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#filter for price-range</span>
</span></span><span style=display:flex><span>price_selected <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>slider(<span style=color:#e6db74>&#34;Select price range&#34;</span>, min_value <span style=color:#f92672>=</span> int(data<span style=color:#f92672>.</span>price<span style=color:#f92672>.</span>min()), max_value<span style=color:#f92672>=</span> int(data<span style=color:#f92672>.</span>price<span style=color:#f92672>.</span>max()), value <span style=color:#f92672>=</span> (<span style=color:#ae81ff>300</span>,<span style=color:#ae81ff>3000</span>), step<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> data[(data<span style=color:#f92672>.</span>price <span style=color:#f92672>&gt;</span> price_selected[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>&amp;</span> (data<span style=color:#f92672>.</span>price <span style=color:#f92672>&lt;</span> price_selected[<span style=color:#ae81ff>1</span>])]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#filter for neighborhoods</span>
</span></span><span style=display:flex><span>neighbourhood_select <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>multiselect(<span style=color:#e6db74>&#39;Select neighbourhoods&#39;</span>, data<span style=color:#f92672>.</span>neighbourhood<span style=color:#f92672>.</span>unique(), data<span style=color:#f92672>.</span>neighbourhood<span style=color:#f92672>.</span>unique())
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> data[data<span style=color:#f92672>.</span>neighbourhood<span style=color:#f92672>.</span>isin(neighbourhood_select)]
</span></span></code></pre></div><h3 id=rendering-the-visualizations>Rendering the visualizations</h3><p>So far nothing is displayed. We only created the objects <code>r</code>(pydeck map) and <code>price_chart</code> altair chart. It&rsquo;s up to you how you like to handle it.
I find it a bit easier to separate compute and render parts.
Here we are going to add a horizontal column split (to make things a bit more pretty). We split the screen into 5 parts, where the first gets 3 and the second 2.
To display our chats, we use the streamlit functions <code>st.pydeck_chart</code> and <code>st.altair_chart</code>. You will find many more options in the <a href=https://docs.streamlit.io/library/api-reference target=_blank>streamlit documentation</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>row1_1, row1_2 <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>columns((<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> row1_1:
</span></span><span style=display:flex><span>    st<span style=color:#f92672>.</span>pydeck_chart(r)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> row1_2:
</span></span><span style=display:flex><span>    st<span style=color:#f92672>.</span>altair_chart(price_chart, use_container_width<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span></code></pre></div><h3 id=requirements>Requirements</h3><p>Our imports for that project look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> streamlit <span style=color:#66d9ef>as</span> st
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> streamlit.components.v1 <span style=color:#66d9ef>as</span> components
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pydeck <span style=color:#66d9ef>as</span> pdk
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> altair <span style=color:#66d9ef>as</span> alt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>alt<span style=color:#f92672>.</span>renderers<span style=color:#f92672>.</span>set_embed_options(theme<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;dark&#39;</span>)
</span></span></code></pre></div><p>In contrast to a notebook, we cannot really install packages on the fly. Considering a simple python deployment environment, we need to specify what packages (aside from streamlit) need to be installed so that the app can run.
This is often done by adding a <code>requirements.txt</code> file to the project folder. We add all libraries that we loaded just to be sure. This is not always the best idea, as things can clash&mldr; but that is a chapter of its own to be covered at a later point. 😵</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>pydeck
</span></span><span style=display:flex><span>altair
</span></span><span style=display:flex><span>numpy
</span></span><span style=display:flex><span>pandas
</span></span></code></pre></div><h3 id=all-code-in-one-place>All code in one place</h3><p><code>requirements.txt</code><div class=expand><div class=expand-label style=cursor:pointer onclick='$h=$(this),$h.next("div").slideToggle(100,function(){$h.children("i").attr("class",function(){return $h.next("div").is(":visible")?"fas fa-chevron-down":"fas fa-chevron-right"})})'><i style=font-size:x-small class="fas fa-chevron-right"></i>
<span>Expand to see code...</span></div><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>pydeck
</span></span><span style=display:flex><span>numpy
</span></span><span style=display:flex><span>pandas
</span></span><span style=display:flex><span>altair
</span></span></code></pre></div></div></div></p><p><code>app.py</code><div class=expand><div class=expand-label style=cursor:pointer onclick='$h=$(this),$h.next("div").slideToggle(100,function(){$h.children("i").attr("class",function(){return $h.next("div").is(":visible")?"fas fa-chevron-down":"fas fa-chevron-right"})})'><i style=font-size:x-small class="fas fa-chevron-right"></i>
<span>Expand to see code...</span></div><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#imports</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> streamlit <span style=color:#66d9ef>as</span> st
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> streamlit.components.v1 <span style=color:#66d9ef>as</span> components
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pydeck <span style=color:#66d9ef>as</span> pdk
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> altair <span style=color:#66d9ef>as</span> alt
</span></span><span style=display:flex><span>alt<span style=color:#f92672>.</span>renderers<span style=color:#f92672>.</span>set_embed_options(theme<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;dark&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># page config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>st<span style=color:#f92672>.</span>set_page_config(page_title<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Streamlit - Dashboard 🤯&#39;</span>,
</span></span><span style=display:flex><span>                    page_icon<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;🚀&#34;</span>,
</span></span><span style=display:flex><span>                    layout<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;wide&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#load data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@st</span><span style=color:#f92672>.</span>experimental_singleton
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load_data</span>():
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#39;http://data.insideairbnb.com/denmark/hovedstaden/copenhagen/2022-06-24/visualisations/listings.csv&#39;</span>)
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> data[data<span style=color:#f92672>.</span>number_of_reviews <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> data[data<span style=color:#f92672>.</span>room_type<span style=color:#f92672>.</span>isin([<span style=color:#e6db74>&#39;Private room&#39;</span>, <span style=color:#e6db74>&#39;Entire home/apt&#39;</span>])]
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#39;price_z&#39;</span>] <span style=color:#f92672>=</span> (data[<span style=color:#e6db74>&#39;price&#39;</span>] <span style=color:#f92672>-</span>data[<span style=color:#e6db74>&#39;price&#39;</span>]<span style=color:#f92672>.</span>mean())<span style=color:#f92672>/</span>data[<span style=color:#e6db74>&#39;price&#39;</span>]<span style=color:#f92672>.</span>std(ddof<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#39;price_z&#39;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;price_z&#39;</span>]<span style=color:#f92672>.</span>abs()
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> data[data<span style=color:#f92672>.</span>price_z <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> load_data()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. Page layout - e.g. a title</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>st<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#34;AirBnb rentals in Copenhagen 🇩🇰&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#filter for price-range</span>
</span></span><span style=display:flex><span>price_selected <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>slider(<span style=color:#e6db74>&#34;Select price range&#34;</span>, min_value <span style=color:#f92672>=</span> int(data<span style=color:#f92672>.</span>price<span style=color:#f92672>.</span>min()), max_value<span style=color:#f92672>=</span> int(data<span style=color:#f92672>.</span>price<span style=color:#f92672>.</span>max()), value <span style=color:#f92672>=</span> (<span style=color:#ae81ff>300</span>,<span style=color:#ae81ff>3000</span>), step<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> data[(data<span style=color:#f92672>.</span>price <span style=color:#f92672>&gt;</span> price_selected[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>&amp;</span> (data<span style=color:#f92672>.</span>price <span style=color:#f92672>&lt;</span> price_selected[<span style=color:#ae81ff>1</span>])]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#filter for neighborhoods</span>
</span></span><span style=display:flex><span>neighbourhood_select <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>multiselect(<span style=color:#e6db74>&#39;Select neighbourhoods&#39;</span>, data<span style=color:#f92672>.</span>neighbourhood<span style=color:#f92672>.</span>unique(), data<span style=color:#f92672>.</span>neighbourhood<span style=color:#f92672>.</span>unique())
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> data[data<span style=color:#f92672>.</span>neighbourhood<span style=color:#f92672>.</span>isin(neighbourhood_select)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#geoplot</span>
</span></span><span style=display:flex><span>layer <span style=color:#f92672>=</span> pdk<span style=color:#f92672>.</span>Layer(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ScatterplotLayer&#34;</span>,
</span></span><span style=display:flex><span>        data<span style=color:#f92672>=</span>data[[<span style=color:#e6db74>&#39;name&#39;</span>,<span style=color:#e6db74>&#39;room_type&#39;</span>,<span style=color:#e6db74>&#39;price&#39;</span>, <span style=color:#e6db74>&#34;longitude&#34;</span>, <span style=color:#e6db74>&#34;latitude&#34;</span>]]<span style=color:#f92672>.</span>dropna(),
</span></span><span style=display:flex><span>        pickable<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>        opacity<span style=color:#f92672>=</span><span style=color:#ae81ff>0.7</span>,
</span></span><span style=display:flex><span>        stroked<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>        filled<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>        radius_scale<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>        radius_min_pixels<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        radius_max_pixels<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>,
</span></span><span style=display:flex><span>        line_width_min_pixels<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        get_position<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;longitude&#34;</span>, <span style=color:#e6db74>&#34;latitude&#34;</span>],
</span></span><span style=display:flex><span>        get_radius<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span><span style=color:#f92672>*</span><span style=color:#e6db74>&#34;log_price&#34;</span>,
</span></span><span style=display:flex><span>        get_color<span style=color:#f92672>=</span>[<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>140</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>        get_line_color<span style=color:#f92672>=</span>[<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set the viewport location</span>
</span></span><span style=display:flex><span>view_state <span style=color:#f92672>=</span> pdk<span style=color:#f92672>.</span>ViewState(latitude<span style=color:#f92672>=</span>data[<span style=color:#e6db74>&#39;latitude&#39;</span>]<span style=color:#f92672>.</span>mean(), longitude<span style=color:#f92672>=</span>data[<span style=color:#e6db74>&#39;longitude&#39;</span>]<span style=color:#f92672>.</span>mean(), zoom<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>, pitch<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Renders</span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> pdk<span style=color:#f92672>.</span>Deck(layers<span style=color:#f92672>=</span>[layer], 
</span></span><span style=display:flex><span>initial_view_state<span style=color:#f92672>=</span>view_state,
</span></span><span style=display:flex><span><span style=color:#75715e>#map_style=&#39;mapbox://styles/mapbox/light-v9&#39;,</span>
</span></span><span style=display:flex><span>tooltip<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;text&#34;</span>: <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{name}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{room_type}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{price}</span><span style=color:#e6db74>&#34;</span>}
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># prefilter for altair</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len(data) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>5000</span>:
</span></span><span style=display:flex><span>    data_alt <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>sample(<span style=color:#ae81ff>5000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len(data) <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>5000</span>:
</span></span><span style=display:flex><span>    data_alt <span style=color:#f92672>=</span> data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#altair plot</span>
</span></span><span style=display:flex><span>price_chart <span style=color:#f92672>=</span> alt<span style=color:#f92672>.</span>Chart(data)<span style=color:#f92672>.</span>mark_bar()<span style=color:#f92672>.</span>encode(
</span></span><span style=display:flex><span>    x<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;mean(price):Q&#39;</span>,
</span></span><span style=display:flex><span>    y<span style=color:#f92672>=</span>alt<span style=color:#f92672>.</span>Y(<span style=color:#e6db74>&#39;room_type:O&#39;</span>,axis<span style=color:#f92672>=</span>alt<span style=color:#f92672>.</span>Axis(labels<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>), title<span style=color:#f92672>=</span><span style=color:#e6db74>&#34; &#34;</span>),
</span></span><span style=display:flex><span>    color<span style=color:#f92672>=</span>alt<span style=color:#f92672>.</span>Color(<span style=color:#e6db74>&#39;room_type:N&#39;</span>, scale<span style=color:#f92672>=</span>alt<span style=color:#f92672>.</span>Scale(scheme<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;lightorange&#39;</span>)),
</span></span><span style=display:flex><span>    row<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;neighbourhood:N&#39;</span>,
</span></span><span style=display:flex><span>    tooltip<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;neighbourhood:N&#34;</span>, <span style=color:#e6db74>&#34;mean(price):Q&#34;</span>]
</span></span><span style=display:flex><span>)<span style=color:#f92672>.</span>configure_view(strokeWidth<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>interactive()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># display and layout</span>
</span></span><span style=display:flex><span>row1_1, row1_2 <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>columns((<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> row1_1:
</span></span><span style=display:flex><span>    st<span style=color:#f92672>.</span>pydeck_chart(r)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> row1_2:
</span></span><span style=display:flex><span>    st<span style=color:#f92672>.</span>altair_chart(price_chart, use_container_width<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span></code></pre></div></div></div></p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/DSBA-2022/m1/02_basics/03_data_visualization/ title="Basics Data Visualization"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/DSBA-2022/m1/03_ml/ title="Basics Machine Learning (W37-38)" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/DSBA-2022/js/clipboard.min.js?1668851358></script>
<script src=/DSBA-2022/js/perfect-scrollbar.min.js?1668851358></script>
<script src=/DSBA-2022/js/perfect-scrollbar.jquery.min.js?1668851358></script>
<script src=/DSBA-2022/js/jquery.sticky.js?1668851358></script>
<script src=/DSBA-2022/js/featherlight.min.js?1668851358></script>
<script src=/DSBA-2022/js/highlight.pack.js?1668851358></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/DSBA-2022/js/modernizr.custom-3.6.0.js?1668851358></script>
<script src=/DSBA-2022/js/learn.js?1668851358></script>
<script src=/DSBA-2022/js/hugo-learn.js?1668851358></script>
<script src=/DSBA-2022/mermaid/mermaid.js?1668851358></script>
<script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-105947713-1","auto"),ga("send","pageview")</script></body></html>